/*-------------------------------------------------------------------------------*\||	File:	Keyboard.c||	Description:||||||	Copyright ©	1994, Alan Steremberg and Ed Wynne|\*-------------------------------------------------------------------------------*/#include "KeyboardTable.h"#include "Keyboard.h"/*	local constants	*/#define	kNoKey		0xFF/*	local globals	*/KeyboardScanMask	gKeyMask;KeyTranslation		*gKeyTrans;extern	Boolean	gCommdoreHasFocus;unsigned long ReadKeyboardRow(void){	register unsigned char	byte;	register unsigned char	bit;	register unsigned char	cur;	unsigned char				keys[16];	unsigned long				val;		if (!gCommdoreHasFocus)		return	kNoKey;		GetKeys((long*)&keys[0]);	if (keys[6]&0x80)		return kNoKey;			val = 0;	keys[15] &= 0x7F;	gKeyTrans = (keys[7]&0x03) ? ShiftTranslationTable : NormalTranslationTable;	keys[7] &= 0xFC;		for (byte=0;byte<16;byte++)		if ((cur = keys[byte]) != 0)			for (bit=0;bit<8;bit++)			{				if (cur&0x01)					val |= ConvertKeyCode((byte<<3)+bit);								cur >>= 1;			}	return (0xFF-val);}unsigned long ConvertKeyCode(unsigned long key){	unsigned long	result = 0;			if (gKeyTrans[key].mask & ~gKeyMask.byte)		result |= gKeyTrans[key].val;	if (gKeyTrans[key].mask2 & ~gKeyMask.byte)		result |= gKeyTrans[key].val2;	return result;}