/*-------------------------------------------------------------------------------*\||	File:	Preference.c||	Description:||||||	Copyright ï¿½	1994, Alan Steremberg and Ed Wynne|\*-------------------------------------------------------------------------------*///#include <Folders.h>//#include <Script.h>#include "Preference.h"#if 0/*	local constants	*/#define	kPrefsVersion		0x00000001#define	kVersionPref		'VerS'#define	kVersionPrefID		128#define	kPrefsName			"\pC Files Preferences"#define	kPrefsCreator		'????'#define	kPrefsType			'pref'/*	local globals	*/short		gPrefsGood = 0;void InitPreferences(void){	Handle	version;	FSSpec	spec;	short		err;			err = GetPrefsSpec(&spec);	if (err)		return;	else		gPrefsGood = 1;		version = GetPreference(kVersionPref,kVersionPrefID);	if (!version || (*(long*)(*version) != kPrefsVersion))	{		FSpDelete(&spec);		GetPrefsSpec(&spec);	}}void CleanUpPreferences(void){	}void AddDefaultPreferences(void){	Handle	data;			data = NewHandle(sizeof(long));	assert (data!=NULL);	*(long*)(*data) = kPrefsVersion;	AddResource(data,kVersionPref,kVersionPrefID,"\p");	ReleaseResource(data);}short GetPrefsSpec(FSSpec *spec){	long	dirID;	short	vRefNum,err,fRefNum;			FindFolder(kOnSystemDisk,kPreferencesFolderType,kCreateFolder,&vRefNum,&dirID);	err = FSMakeFSSpec(vRefNum,dirID,kPrefsName,spec);	if (err)	{		FSpCreateResFile(spec,kPrefsCreator,kPrefsType,smSystemScript);		err = ResError();		if (!err)		{			fRefNum = FSpOpenResFile(spec,fsRdWrPerm);			AddDefaultPreferences();			CloseResFile(fRefNum);		}	}		return err;}Handle GetPreference(ResType type,short ID){	Handle	pref;	FSSpec	spec;	short		fRefNum;			if (!gPrefsGood)		return NULL;		GetPrefsSpec(&spec);	fRefNum = FSpOpenResFile(&spec,fsRdWrPerm);		pref = Get1Resource(type,ID);	if (pref && !ResError())		DetachResource(pref);		CloseResFile(fRefNum);	return pref;}short SetPreference(ResType type,short ID,Handle pref){	Handle	newPref,oldPref;	FSSpec	spec;	short		fRefNum,err;			if (!gPrefsGood)		return -1;		newPref = pref;	HandToHand(&newPref);		GetPrefsSpec(&spec);	fRefNum = FSpOpenResFile(&spec,fsRdWrPerm);		oldPref = Get1Resource(type,ID);	if (oldPref && !ResError())		RemoveResource(oldPref);		AddResource(newPref,type,ID,"\p");	err = ResError();	if (!err)		ReleaseResource(newPref);	else		DisposeHandle(newPref);		CloseResFile(fRefNum);	return err;}#endif