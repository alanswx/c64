/*-------------------------------------------------------------------------------*\||	File:	Traps.c||	Description:||||||	Copyright ©	1994, Alan Steremberg and Ed Wynne|\*-------------------------------------------------------------------------------*/#include "Memory.h"#include "Traps.h"#include "CPU.h"#define MAXTRAPS 16static trap trapList[MAXTRAPS];static unsigned	char numTraps;#define	kWrongROMError	-1/*	external globals	*/extern ReadHandler			*gMemRead;							//	Memory.cextern WriteHandler			*gMemWrite;							//	Memory.cextern	unsigned char		*gKernalROM;int TrapInitialize(){    numTraps=0;    return noErr;}/*CalledBy:SerialInitialize*/int AddTrap(trap t){	/* If we are at out limit for traps, then internal error */	if (numTraps==MAXTRAPS) DebugStr("\pkTrapStorageOverflow");		/* Check to see if the ROMs and the trap agree */	if (t.check[0]!=gKernalROM[t.addr  	- 0xE000]) return kWrongROMError;	if (t.check[1]!=gKernalROM[t.addr+1 - 0xE000]) return kWrongROMError;	if (t.check[2]!=gKernalROM[t.addr+2 - 0xE000]) return kWrongROMError;		/* Add this trap to out list */	trapList[numTraps++]=t;	/*replace with trap 0xFF*/		gKernalROM[t.addr-0xE000]=0xFF;    return noErr;}void TrapExecute(unsigned long	pc){	int x;		/* Search for a trap at the current pc location, and if so execute it */	for (x=0; x<numTraps; x++)		if (trapList[x].addr==(pc-1)) {			(*trapList[x].call)();			return; }	CPUOP_FF_INS();}